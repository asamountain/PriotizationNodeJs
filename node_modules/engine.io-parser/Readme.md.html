<html><head><title>Readme.md</title></head><body><h1>engine.io-parser</h1>
<p><a href="https://github.com/socketio/engine.io-parser/actions"><img src="https://github.com/socketio/engine.io-parser/workflows/CI/badge.svg?branch=main" alt="Build Status" /></a>
<a href="https://npmjs.com/package/engine.io-parser"><img src="https://badge.fury.io/js/engine.io-parser.svg" alt="NPM version" /></a></p>
<p>This is the JavaScript parser for the engine.io protocol encoding,
shared by both
<a href="https://github.com/socketio/engine.io-client">engine.io-client</a> and
<a href="https://github.com/socketio/engine.io">engine.io</a>.</p>
<h2>How to use</h2>
<h3>Standalone</h3>
<p>The parser can encode/decode packets, payloads, and payloads as binary
with the following methods: <code>encodePacket</code>, <code>decodePacket</code>, <code>encodePayload</code>,
<code>decodePayload</code>.</p>
<p>Example:</p>
<pre><code class="language-js">const parser = require(&quot;engine.io-parser&quot;);
const data = Buffer.from([ 1, 2, 3, 4 ]);

parser.encodePacket({ type: &quot;message&quot;, data }, encoded =&gt; {
  const decodedData = parser.decodePacket(encoded); // decodedData === data
});
</code></pre>
<h3>With browserify</h3>
<p>Engine.IO Parser is a commonjs module, which means you can include it by using
<code>require</code> on the browser and package using <a href="http://browserify.org/">browserify</a>:</p>
<ol>
<li>
<p>install the parser package</p>
<pre><code class="language-shell">npm install engine.io-parser
</code></pre>
</li>
<li>
<p>write your app code</p>
<pre><code class="language-js">const parser = require(&quot;engine.io-parser&quot;);

const testBuffer = new Int8Array(10);
for (let i = 0; i &lt; testBuffer.length; i++) testBuffer[i] = i;

const packets = [{ type: &quot;message&quot;, data: testBuffer.buffer }, { type: &quot;message&quot;, data: &quot;hello&quot; }];

parser.encodePayload(packets, encoded =&gt; {
  parser.decodePayload(encoded,
    (packet, index, total) =&gt; {
      const isLast = index + 1 == total;
      if (!isLast) {
        const buffer = new Int8Array(packet.data); // testBuffer
      } else {
        const message = packet.data; // &quot;hello&quot;
      }
    });
});
</code></pre>
</li>
<li>
<p>build your app bundle</p>
<pre><code class="language-bash">$ browserify app.js &gt; bundle.js
</code></pre>
</li>
<li>
<p>include on your page</p>
<pre><code class="language-html">&lt;script src=&quot;/path/to/bundle.js&quot;&gt;&lt;/script&gt;
</code></pre>
</li>
</ol>
<h2>Features</h2>
<ul>
<li>Runs on browser and node.js seamlessly</li>
<li>Runs inside HTML5 WebWorker</li>
<li>Can encode and decode packets
<ul>
<li>Encodes from/to ArrayBuffer or Blob when in browser, and Buffer or ArrayBuffer in Node</li>
</ul>
</li>
</ul>
<h2>API</h2>
<p>Note: <code>cb(type)</code> means the type is a callback function that contains a parameter of type <code>type</code> when called.</p>
<h3>Node</h3>
<ul>
<li>
<p><code>encodePacket</code></p>
<ul>
<li>Encodes a packet.</li>
<li><strong>Parameters</strong>
<ul>
<li><code>Object</code>: the packet to encode, has <code>type</code> and <code>data</code>.
<ul>
<li><code>data</code>: can be a <code>String</code>, <code>Number</code>, <code>Buffer</code>, <code>ArrayBuffer</code></li>
</ul>
</li>
<li><code>Boolean</code>: binary support</li>
<li><code>Function</code>: callback, returns the encoded packet (<code>cb(String)</code>)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>decodePacket</code></p>
<ul>
<li>Decodes a packet. Data also available as an ArrayBuffer if requested.</li>
<li>Returns data as <code>String</code> or (<code>Blob</code> on browser, <code>ArrayBuffer</code> on Node)</li>
<li><strong>Parameters</strong>
<ul>
<li><code>String</code> | <code>ArrayBuffer</code>: the packet to decode, has <code>type</code> and <code>data</code></li>
<li><code>String</code>: optional, the binary type</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>encodePayload</code></p>
<ul>
<li>Encodes multiple messages (payload).</li>
<li>If any contents are binary, they will be encoded as base64 strings. Base64
encoded strings are marked with a b before the length specifier</li>
<li><strong>Parameters</strong>
<ul>
<li><code>Array</code>: an array of packets</li>
<li><code>Function</code>: callback, returns the encoded payload (<code>cb(String)</code>)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>decodePayload</code></p>
<ul>
<li>Decodes data when a payload is maybe expected. Possible binary contents are
decoded from their base64 representation.</li>
<li><strong>Parameters</strong>
<ul>
<li><code>String</code>: the payload</li>
<li><code>Function</code>: callback, returns (cb(<code>Object</code>: packet, <code>Number</code>:packet index, <code>Number</code>:packet total))</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Tests</h2>
<p>Standalone tests can be run with <code>npm test</code> which will run the node.js tests.</p>
<p>Browser tests are run using <a href="https://github.com/defunctzombie/zuul">zuul</a>.
(You must have zuul setup with a saucelabs account.)</p>
<p>You can run the tests locally using the following command:</p>
<pre><code>npm run test:browser
</code></pre>
<h2>Support</h2>
<p>The support channels for <code>engine.io-parser</code> are the same as <code>socket.io</code>:</p>
<ul>
<li>irc.freenode.net <strong>#socket.io</strong></li>
<li><a href="https://github.com/socketio/socket.io/discussions">Github Discussions</a></li>
<li><a href="https://socket.io">Website</a></li>
</ul>
<h2>Development</h2>
<p>To contribute patches, run tests or benchmarks, make sure to clone the
repository:</p>
<pre><code class="language-bash">git clone git://github.com/socketio/engine.io-parser.git
</code></pre>
<p>Then:</p>
<pre><code class="language-bash">cd engine.io-parser
npm ci
</code></pre>
<p>See the <code>Tests</code> section above for how to run tests before submitting any patches.</p>
<h2>License</h2>
<p>MIT</p>
</body></html>