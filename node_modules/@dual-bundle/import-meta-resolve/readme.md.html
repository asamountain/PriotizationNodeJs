<html><head><title>readme.md</title></head><body><h1><code>@dual-bundle/import-meta-resolve</code></h1>
<p>A fork of <a href="https://github.com/wooorm/import-meta-resolve"><code>import-meta-resolve</code></a>
with commonjs + ESM support at the same time, AKA dual package.</p>
<p>It will rebase and try to release in order to sync with the upstream every day,
see <a href=".github/workflows/rebase.yml">.github/workflows/rebase.yml</a> for details.</p>
<h2>Installation</h2>
<pre><code class="language-bash"># npm
npm install @dual-bundle/import-meta-resolve

# yarn
yarn add @dual-bundle/import-meta-resolve
</code></pre>
<hr />
<h1>import-meta-resolve</h1>
<p><a href="https://github.com/wooorm/import-meta-resolve/actions"><img src="https://github.com/wooorm/import-meta-resolve/workflows/main/badge.svg" alt="Build" /></a>
<a href="https://codecov.io/github/wooorm/import-meta-resolve"><img src="https://img.shields.io/codecov/c/github/wooorm/import-meta-resolve.svg" alt="Coverage" /></a>
<a href="https://www.npmjs.com/package/import-meta-resolve"><img src="https://img.shields.io/npm/dm/import-meta-resolve.svg" alt="Downloads" /></a></p>
<p>Resolve things like Node.js.</p>
<h2>Contents</h2>
<ul>
<li><a href="#what-is-this">What is this?</a></li>
<li><a href="#when-to-use-this">When to use this?</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#use">Use</a></li>
<li><a href="#api">API</a>
<ul>
<li><a href="#resolvespecifier-parent"><code>resolve(specifier, parent)</code></a></li>
<li><a href="#moduleresolvespecifier-parent-conditions-preservesymlinks"><code>moduleResolve(specifier, parent, conditions, preserveSymlinks)</code></a></li>
<li><a href="#errnoexception"><code>ErrnoException</code></a></li>
</ul>
</li>
<li><a href="#algorithm">Algorithm</a></li>
<li><a href="#differences-to-node">Differences to Node</a></li>
<li><a href="#types">Types</a></li>
<li><a href="#compatibility">Compatibility</a></li>
<li><a href="#contribute">Contribute</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2>What is this?</h2>
<p>This package is a ponyfill for <a href="https://nodejs.org/api/esm.html#esm_import_meta_resolve_specifier_parent"><code>import.meta.resolve</code></a>.
It supports everything you need to resolve files just like modern Node does:
import maps, export maps, loading CJS and ESM projects, all of that!</p>
<h2>When to use this?</h2>
<p>As of Node.js 20.0, <code>import.meta.resolve</code> is still behind an experimental flag.
This package can be used to do what it does in Node 16–20.</p>
<h2>Install</h2>
<p>This package is <a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c">ESM only</a>.
In Node.js (version 16+), install with <a href="https://docs.npmjs.com/cli/install">npm</a>:</p>
<pre><code class="language-sh">npm install import-meta-resolve
</code></pre>
<h2>Use</h2>
<pre><code class="language-js">import {resolve} from 'import-meta-resolve'

// A file:
console.log(resolve('./index.js', import.meta.url))
//=&gt; file:///Users/tilde/Projects/oss/import-meta-resolve/index.js

// A CJS package:
console.log(resolve('builtins', import.meta.url))
//=&gt; file:///Users/tilde/Projects/oss/import-meta-resolve/node_modules/builtins/index.js

// A scoped CJS package:
console.log(resolve('@eslint/eslintrc', import.meta.url))
//=&gt; file:///Users/tilde/Projects/oss/import-meta-resolve/node_modules/@eslint/eslintrc/lib/index.js

// A package with an export map:
console.log(resolve('micromark/lib/parse', import.meta.url))
//=&gt; file:///Users/tilde/Projects/oss/import-meta-resolve/node_modules/micromark/lib/parse.js

// A node builtin:
console.log(resolve('fs', import.meta.url))
//=&gt; node:fs
</code></pre>
<h2>API</h2>
<p>This package exports the identifiers <a href="#moduleResolvespecifier-parent-conditions-preserveSymlinks"><code>moduleResolve</code></a> and
<a href="#resolvespecifier-parent"><code>resolve</code></a>.
There is no default export.</p>
<h3><code>resolve(specifier, parent)</code></h3>
<p>Match <code>import.meta.resolve</code> except that <code>parent</code> is required (you can pass
<code>import.meta.url</code>).</p>
<h6>Parameters</h6>
<ul>
<li><code>specifier</code> (<code>string</code>)
— the module specifier to resolve relative to parent
(<code>/example.js</code>, <code>./example.js</code>, <code>../example.js</code>, <code>some-package</code>, <code>fs</code>, etc)</li>
<li><code>parent</code> (<code>string</code>, example: <code>import.meta.url</code>)
— the absolute parent module URL to resolve from; you must pass
<code>import.meta.url</code> or something else</li>
</ul>
<h6>Returns</h6>
<p>Full <code>file:</code>, <code>data:</code>, or <code>node:</code> URL (<code>string</code>) to the found thing</p>
<h6>Throws</h6>
<p>Throws an <a href="#errnoexception"><code>ErrnoException</code></a>.</p>
<h3><code>moduleResolve(specifier, parent, conditions, preserveSymlinks)</code></h3>
<p>The <a href="https://nodejs.org/dist/latest-v14.x/docs/api/esm.html#esm_resolver_algorithm">“Resolver Algorithm Specification”</a> as detailed in the Node docs
(which is slightly lower-level than <code>resolve</code>).</p>
<h6>Parameters</h6>
<ul>
<li><code>specifier</code> (<code>string</code>)
— <code>/example.js</code>, <code>./example.js</code>, <code>../example.js</code>, <code>some-package</code>, <code>fs</code>, etc</li>
<li><code>parent</code> (<code>URL</code>, example: <code>import.meta.url</code>)
— full URL (to a file) that <code>specifier</code> is resolved relative from</li>
<li><code>conditions</code> (<code>Set&lt;string&gt;</code>, default: <code>new Set(['node', 'import'])</code>)
— conditions</li>
<li><code>preserveSymlinks</code> (<code>boolean</code>, default: <code>false</code>)
— keep symlinks instead of resolving them</li>
</ul>
<h6>Returns</h6>
<p>A URL object (<code>URL</code>) to the found thing.</p>
<h6>Throws</h6>
<p>Throws an <a href="#errnoexception"><code>ErrnoException</code></a>.</p>
<h3><code>ErrnoException</code></h3>
<p>One of many different errors that occur when resolving (TypeScript type).</p>
<h6>Type</h6>
<pre><code class="language-ts">type ErrnoExceptionFields = Error &amp; {
  errnode?: number | undefined
  code?: string | undefined
  path?: string | undefined
  syscall?: string | undefined
  url?: string | undefined
}
</code></pre>
<p>The <code>code</code> field on errors is one of the following strings:</p>
<ul>
<li><code>'ERR_INVALID_MODULE_SPECIFIER'</code>
— when <code>specifier</code> is invalid (example: <code>'#'</code>)</li>
<li><code>'ERR_INVALID_PACKAGE_CONFIG'</code>
— when a <code>package.json</code> is invalid (example: invalid JSON)</li>
<li><code>'ERR_INVALID_PACKAGE_TARGET'</code>
— when a <code>package.json</code> <code>exports</code> or <code>imports</code> is invalid (example: when it
does not start with <code>'./'</code>)</li>
<li><code>'ERR_MODULE_NOT_FOUND'</code>
— when <code>specifier</code> cannot be found in <code>parent</code> (example: <code>'some-missing-package'</code>)</li>
<li><code>'ERR_NETWORK_IMPORT_DISALLOWED'</code>
— thrown when trying to resolve a local file or builtin from a remote file
(<code>node:fs</code> relative to <code>'https://example.com'</code>)</li>
<li><code>'ERR_PACKAGE_IMPORT_NOT_DEFINED'</code>
— when a local import is not defined in an import map (example: <code>'#local'</code>
when not defined)</li>
<li><code>'ERR_PACKAGE_PATH_NOT_EXPORTED'</code>
— when an export is not defined in an export map (example: <code>'tape/index.js'</code>,
which is not in its export map)</li>
<li><code>'ERR_UNSUPPORTED_DIR_IMPORT'</code>
— when attempting to import a directory (example: <code>'./lib/'</code>)</li>
<li><code>'ERR_UNKNOWN_FILE_EXTENSION'</code>
— when somehow reading a file that has an unexpected extensions (<code>'./readme.md'</code>)</li>
<li><code>'ERR_INVALID_ARG_VALUE'</code>
— when <code>conditions</code> is incorrect</li>
</ul>
<h2>Algorithm</h2>
<p>The algorithm for <code>resolve</code> matches how Node handles <code>import.meta.resolve</code>, with
a couple of differences.</p>
<p>The algorithm for <code>moduleResolve</code> matches the <a href="https://nodejs.org/dist/latest-v14.x/docs/api/esm.html#esm_resolver_algorithm">Resolver Algorithm
Specification</a> as detailed in the Node docs (which is sync and slightly
lower-level than <code>resolve</code>).</p>
<h2>Differences to Node</h2>
<ul>
<li><code>parent</code> defaulting to <code>import.meta.url</code> cannot be ponyfilled: you have to
explicitly pass it</li>
<li>no support for loaders (that would mean implementing all of loaders)</li>
<li>no support for CLI flags:
<code>--conditions</code>,
<code>--experimental-default-type</code>,
<code>--experimental-json-modules</code>,
<code>--experimental-network-imports</code>,
<code>--experimental-policy</code>,
<code>--experimental-wasm-modules</code>,
<code>--input-type</code>,
<code>--no-addons</code>,
<code>--preserve-symlinks</code>, nor
<code>--preserve-symlinks-main</code>
work</li>
<li>no support for <code>WATCH_REPORT_DEPENDENCIES</code> env variable</li>
<li>no attempt is made to add a suggestion based on how things used to work in
CJS before to not-found errors</li>
<li>prototypal methods are not guarded: Node protects for example <code>String#slice</code>
or so from being tampered with, whereas this doesn’t</li>
</ul>
<h2>Types</h2>
<p>This package is fully typed with <a href="https://www.typescriptlang.org">TypeScript</a>.
It exports the additional type <a href="#errnoexception"><code>ErrnoException</code></a>.</p>
<h2>Compatibility</h2>
<p>This package is at least compatible with all maintained versions of Node.js.
As of now, that is Node.js 16 and later.</p>
<h2>Contribute</h2>
<p>Yes please!
See <a href="https://opensource.guide/how-to-contribute/">How to Contribute to Open Source</a>.</p>
<h2>License</h2>
<p><a href="license">MIT</a> © <a href="https://wooorm.com">Titus Wormer</a> and Node.js contributors</p>
<!-- raw HTML omitted -->
</body></html>