<html><head><title>README.md</title></head><body><h1>⚙️ node-sqlite3</h1>
<p>Asynchronous, non-blocking <a href="https://sqlite.org/">SQLite3</a> bindings for <a href="http://nodejs.org/">Node.js</a>.</p>
<p><a href="https://www.npmjs.com/package/sqlite3"><img src="https://img.shields.io/github/release/TryGhost/node-sqlite3.svg" alt="Latest release" /></a>
<img src="https://github.com/TryGhost/node-sqlite3/workflows/CI/badge.svg?branch=master" alt="Build Status" />
<a href="https://app.fossa.io/projects/git%2Bhttps%3A%2F%2Fgithub.com%2Fmapbox%2Fnode-sqlite3?ref=badge_shield"><img src="https://app.fossa.io/api/projects/git%2Bhttps%3A%2F%2Fgithub.com%2Fmapbox%2Fnode-sqlite3.svg?type=shield" alt="FOSSA Status" /></a>
<a href="https://nodejs.org/dist/latest/docs/api/n-api.html#n_api_n_api"><img src="https://img.shields.io/badge/N--API-v3-green.svg" alt="N-API v3 Badge" /></a>
<a href="https://nodejs.org/dist/latest/docs/api/n-api.html#n_api_n_api"><img src="https://img.shields.io/badge/N--API-v6-green.svg" alt="N-API v6 Badge" /></a></p>
<h1>Features</h1>
<ul>
<li>Straightforward query and parameter binding interface</li>
<li>Full Buffer/Blob support</li>
<li>Extensive <a href="https://github.com/tryghost/node-sqlite3/wiki/Debugging">debugging support</a></li>
<li><a href="https://github.com/tryghost/node-sqlite3/wiki/Control-Flow">Query serialization</a> API</li>
<li><a href="https://github.com/TryGhost/node-sqlite3/wiki/API#databaseloadextensionpath-callback">Extension support</a>, including bundled support for the <a href="https://www.sqlite.org/json1.html">json1 extension</a></li>
<li>Big test suite</li>
<li>Written in modern C++ and tested for memory leaks</li>
<li>Bundles SQLite v3.44.2, or you can build using a local SQLite</li>
</ul>
<h1>Installing</h1>
<p>You can use <a href="https://github.com/npm/cli"><code>npm</code></a> or <a href="https://github.com/yarnpkg/yarn"><code>yarn</code></a> to install <code>sqlite3</code>:</p>
<ul>
<li>(recommended) Latest published package:</li>
</ul>
<pre><code class="language-bash">npm install sqlite3
# or
yarn add sqlite3
</code></pre>
<ul>
<li>GitHub's <code>master</code> branch: <code>npm install https://github.com/tryghost/node-sqlite3/tarball/master</code></li>
</ul>
<h3>Prebuilt binaries</h3>
<p><code>sqlite3</code> v5+ was rewritten to use <a href="https://nodejs.org/api/n-api.html">Node-API</a> so prebuilt binaries do not need to be built for specific Node versions. <code>sqlite3</code> currently builds for both Node-API v3 and v6. Check the <a href="https://nodejs.org/api/n-api.html#node-api-version-matrix">Node-API version matrix</a> to ensure your Node version supports one of these. The prebuilt binaries should be supported on Node v10+.</p>
<p>The module uses <a href="https://github.com/prebuild/prebuild-install"><code>prebuild-install</code></a> to download the prebuilt binary for your platform, if it exists. These binaries are hosted on GitHub Releases for <code>sqlite3</code> versions above 5.0.2, and they are hosted on S3 otherwise. The following targets are currently provided:</p>
<ul>
<li><code>darwin-arm64</code></li>
<li><code>darwin-x64</code></li>
<li><code>linux-arm64</code></li>
<li><code>linux-x64</code></li>
<li><code>linuxmusl-arm64</code></li>
<li><code>linuxmusl-x64</code></li>
<li><code>win32-ia32</code></li>
<li><code>win32-x64</code></li>
</ul>
<p>Unfortunately, <a href="https://github.com/prebuild/prebuild/issues/174">prebuild</a> cannot differentiate between <code>armv6</code> and <code>armv7</code>, and instead uses <code>arm</code> as the <code>{arch}</code>. Until that is fixed, you will still need to install <code>sqlite3</code> from <a href="#source-install">source</a>.</p>
<p>Support for other platforms and architectures may be added in the future if CI supports building on them.</p>
<p>If your environment isn't supported, it'll use <code>node-gyp</code> to build SQLite, but you will need to install a C++ compiler and linker.</p>
<h3>Other ways to install</h3>
<p>It is also possible to make your own build of <code>sqlite3</code> from its source instead of its npm package (<a href="#source-install">See below.</a>).</p>
<p>The <code>sqlite3</code> module also works with <a href="https://github.com/rogerwang/node-webkit">node-webkit</a> if node-webkit contains a supported version of Node.js engine. <a href="#building-for-node-webkit">(See below.)</a></p>
<p>SQLite's <a href="https://github.com/sqlcipher/sqlcipher">SQLCipher extension</a> is also supported. <a href="#building-for-sqlcipher">(See below.)</a></p>
<h1>API</h1>
<p>See the <a href="https://github.com/TryGhost/node-sqlite3/wiki/API">API documentation</a> in the wiki.</p>
<h1>Usage</h1>
<p><strong>Note:</strong> the module must be <a href="#installing">installed</a> before use.</p>
<pre><code class="language-js">const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database(':memory:');

db.serialize(() =&gt; {
    db.run(&quot;CREATE TABLE lorem (info TEXT)&quot;);

    const stmt = db.prepare(&quot;INSERT INTO lorem VALUES (?)&quot;);
    for (let i = 0; i &lt; 10; i++) {
        stmt.run(&quot;Ipsum &quot; + i);
    }
    stmt.finalize();

    db.each(&quot;SELECT rowid AS id, info FROM lorem&quot;, (err, row) =&gt; {
        console.log(row.id + &quot;: &quot; + row.info);
    });
});

db.close();
</code></pre>
<h2>Source install</h2>
<p>To skip searching for pre-compiled binaries, and force a build from source, use</p>
<pre><code class="language-bash">npm install --build-from-source
</code></pre>
<p>The sqlite3 module depends only on libsqlite3. However, by default, an internal/bundled copy of sqlite will be built and statically linked, so an externally installed sqlite3 is not required.</p>
<p>If you wish to install against an external sqlite then you need to pass the <code>--sqlite</code> argument to <code>npm</code> wrapper:</p>
<pre><code class="language-bash">npm install --build-from-source --sqlite=/usr/local
</code></pre>
<p>If building against an external sqlite3 make sure to have the development headers available. Mac OS X ships with these by default. If you don't have them installed, install the <code>-dev</code> package with your package manager, e.g. <code>apt-get install libsqlite3-dev</code> for Debian/Ubuntu. Make sure that you have at least <code>libsqlite3</code> &gt;= 3.6.</p>
<p>Note, if building against homebrew-installed sqlite on OS X you can do:</p>
<pre><code class="language-bash">npm install --build-from-source --sqlite=/usr/local/opt/sqlite/
</code></pre>
<h2>Custom file header (magic)</h2>
<p>The default sqlite file header is &quot;SQLite format 3&quot;. You can specify a different magic, though this will make standard tools and libraries unable to work with your files.</p>
<pre><code class="language-bash">npm install --build-from-source --sqlite_magic=&quot;MyCustomMagic15&quot;
</code></pre>
<p>Note that the magic <em>must</em> be exactly 15 characters long (16 bytes including null terminator).</p>
<h2>Building for node-webkit</h2>
<p>Because of ABI differences, <code>sqlite3</code> must be built in a custom to be used with <a href="https://github.com/rogerwang/node-webkit">node-webkit</a>.</p>
<p>To build <code>sqlite3</code> for node-webkit:</p>
<ol>
<li>
<p>Install <a href="https://github.com/rogerwang/nw-gyp"><code>nw-gyp</code></a> globally: <code>npm install nw-gyp -g</code> <em>(unless already installed)</em></p>
</li>
<li>
<p>Build the module with the custom flags of <code>--runtime</code>, <code>--target_arch</code>, and <code>--target</code>:</p>
</li>
</ol>
<pre><code class="language-bash">NODE_WEBKIT_VERSION=&quot;0.8.6&quot; # see latest version at https://github.com/rogerwang/node-webkit#downloads
npm install sqlite3 --build-from-source --runtime=node-webkit --target_arch=ia32 --target=$(NODE_WEBKIT_VERSION)
</code></pre>
<p>You can also run this command from within a <code>sqlite3</code> checkout:</p>
<pre><code class="language-bash">npm install --build-from-source --runtime=node-webkit --target_arch=ia32 --target=$(NODE_WEBKIT_VERSION)
</code></pre>
<p>Remember the following:</p>
<ul>
<li>
<p>You must provide the right <code>--target_arch</code> flag. <code>ia32</code> is needed to target 32bit node-webkit builds, while <code>x64</code> will target 64bit node-webkit builds (if available for your platform).</p>
</li>
<li>
<p>After the <code>sqlite3</code> package is built for node-webkit it cannot run in the vanilla Node.js (and vice versa).</p>
<ul>
<li>For example, <code>npm test</code> of the node-webkit's package would fail.</li>
</ul>
</li>
</ul>
<p>Visit the “<a href="https://github.com/rogerwang/node-webkit/wiki/Using-Node-modules">Using Node modules</a>” article in the node-webkit's wiki for more details.</p>
<h2>Building for SQLCipher</h2>
<p>For instructions on building SQLCipher, see <a href="https://coolaj86.com/articles/building-sqlcipher-for-node-js-on-raspberry-pi-2/">Building SQLCipher for Node.js</a>. Alternatively, you can install it with your local package manager.</p>
<p>To run against SQLCipher, you need to compile <code>sqlite3</code> from source by passing build options like:</p>
<pre><code class="language-bash">npm install sqlite3 --build-from-source --sqlite_libname=sqlcipher --sqlite=/usr/

node -e 'require(&quot;sqlite3&quot;)'
</code></pre>
<p>If your SQLCipher is installed in a custom location (if you compiled and installed it yourself), you'll need to set some environment variables:</p>
<h3>On OS X with Homebrew</h3>
<p>Set the location where <code>brew</code> installed it:</p>
<pre><code class="language-bash">export LDFLAGS=&quot;-L`brew --prefix`/opt/sqlcipher/lib&quot;
export CPPFLAGS=&quot;-I`brew --prefix`/opt/sqlcipher/include/sqlcipher&quot;
npm install sqlite3 --build-from-source --sqlite_libname=sqlcipher --sqlite=`brew --prefix`

node -e 'require(&quot;sqlite3&quot;)'
</code></pre>
<h3>On most Linuxes (including Raspberry Pi)</h3>
<p>Set the location where <code>make</code> installed it:</p>
<pre><code class="language-bash">export LDFLAGS=&quot;-L/usr/local/lib&quot;
export CPPFLAGS=&quot;-I/usr/local/include -I/usr/local/include/sqlcipher&quot;
export CXXFLAGS=&quot;$CPPFLAGS&quot;
npm install sqlite3 --build-from-source --sqlite_libname=sqlcipher --sqlite=/usr/local --verbose

node -e 'require(&quot;sqlite3&quot;)'
</code></pre>
<h3>Custom builds and Electron</h3>
<p>Running <code>sqlite3</code> through <a href="https://github.com/electron/electron-rebuild">electron-rebuild</a> does not preserve the SQLCipher extension, so some additional flags are needed to make this build Electron compatible. Your <code>npm install sqlite3 --build-from-source</code> command needs these additional flags (be sure to replace the target version with the current Electron version you are working with):</p>
<pre><code class="language-bash">--runtime=electron --target=18.2.1 --dist-url=https://electronjs.org/headers
</code></pre>
<p>In the case of MacOS with Homebrew, the command should look like the following:</p>
<pre><code class="language-bash">npm install sqlite3 --build-from-source --sqlite_libname=sqlcipher --sqlite=`brew --prefix` --runtime=electron --target=18.2.1 --dist-url=https://electronjs.org/headers
</code></pre>
<h1>Testing</h1>
<pre><code class="language-bash">npm test
</code></pre>
<h1>Contributors</h1>
<ul>
<li><a href="https://github.com/daniellockyer">Daniel Lockyer</a></li>
<li><a href="https://github.com/kkaefer">Konstantin Käfer</a></li>
<li><a href="https://github.com/springmeyer">Dane Springmeyer</a></li>
<li><a href="https://github.com/willwhite">Will White</a></li>
<li><a href="https://github.com/orlandov">Orlando Vazquez</a></li>
<li><a href="https://github.com/artiz">Artem Kustikov</a></li>
<li><a href="https://github.com/grumdrig">Eric Fredricksen</a></li>
<li><a href="https://github.com/mrjjwright">John Wright</a></li>
<li><a href="https://github.com/ry">Ryan Dahl</a></li>
<li><a href="https://github.com/tmcw">Tom MacWright</a></li>
<li><a href="https://github.com/carter-thaxton">Carter Thaxton</a></li>
<li><a href="https://github.com/audriusk">Audrius Kažukauskas</a></li>
<li><a href="https://github.com/pyneo">Johannes Schauer</a></li>
<li><a href="https://github.com/Mithgol">Mithgol</a></li>
<li><a href="https://github.com/kewde">Kewde</a></li>
</ul>
<h1>Acknowledgments</h1>
<p>Thanks to <a href="https://github.com/orlandov">Orlando Vazquez</a>,
<a href="https://github.com/grumdrig">Eric Fredricksen</a> and
<a href="https://github.com/ry">Ryan Dahl</a> for their SQLite bindings for node, and to mraleph on Freenode's #v8 for answering questions.</p>
<p>This module was originally created by <a href="https://mapbox.com/">Mapbox</a> &amp; is now maintained by <a href="https://ghost.org">Ghost</a>.</p>
<h1>Changelog</h1>
<p>We use <a href="https://github.com/TryGhost/node-sqlite3/releases">GitHub releases</a> for notes on the latest versions. See <a href="https://github.com/TryGhost/node-sqlite3/blob/b05f4594cf8b0de64743561fcd2cfe6f4571754d/CHANGELOG.md">CHANGELOG.md</a> in git history for details on older versions.</p>
<h1>License</h1>
<p><code>node-sqlite3</code> is <a href="https://github.com/tryghost/node-sqlite3/raw/master/LICENSE">BSD licensed</a>.</p>
<p><a href="https://app.fossa.io/projects/git%2Bhttps%3A%2F%2Fgithub.com%2Fmapbox%2Fnode-sqlite3?ref=badge_large"><img src="https://app.fossa.io/api/projects/git%2Bhttps%3A%2F%2Fgithub.com%2Fmapbox%2Fnode-sqlite3.svg?type=large" alt="FOSSA Status" /></a></p>
</body></html>