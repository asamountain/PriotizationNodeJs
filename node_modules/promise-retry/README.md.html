<html><head><title>README.md</title></head><body><h1>node-promise-retry</h1>
<p><a href="https://npmjs.org/package/promise-retry"><img src="http://img.shields.io/npm/v/promise-retry.svg" alt="NPM version" /></a> <a href="https://npmjs.org/package/promise-retry"><img src="http://img.shields.io/npm/dm/promise-retry.svg" alt="Downloads" /></a> <a href="https://travis-ci.org/IndigoUnited/node-promise-retry"><img src="http://img.shields.io/travis/IndigoUnited/node-promise-retry/master.svg" alt="Build Status" /></a> <a href="https://david-dm.org/IndigoUnited/node-promise-retry"><img src="https://img.shields.io/david/IndigoUnited/node-promise-retry.svg" alt="Dependency status" /></a> <a href="https://david-dm.org/IndigoUnited/node-promise-retry?type=dev"><img src="https://img.shields.io/david/dev/IndigoUnited/node-promise-retry.svg" alt="Dev Dependency status" /></a> <a href="https://greenkeeper.io/"><img src="https://badges.greenkeeper.io/IndigoUnited/node-promise-retry.svg" alt="Greenkeeper badge" /></a></p>
<p>Retries a function that returns a promise, leveraging the power of the <a href="https://github.com/tim-kos/node-retry">retry</a> module to the promises world.</p>
<p>There's already some modules that are able to retry functions that return promises but
they were rather difficult to use or do not offer an easy way to do conditional retries.</p>
<h2>Installation</h2>
<p><code>$ npm install promise-retry</code></p>
<h2>Usage</h2>
<h3>promiseRetry(fn, [options])</h3>
<p>Calls <code>fn</code> until the returned promise ends up fulfilled or rejected with an error different than
a <code>retry</code> error.<br />
The <code>options</code> argument is an object which maps to the <a href="https://github.com/tim-kos/node-retry">retry</a> module options:</p>
<ul>
<li><code>retries</code>: The maximum amount of times to retry the operation. Default is <code>10</code>.</li>
<li><code>factor</code>: The exponential factor to use. Default is <code>2</code>.</li>
<li><code>minTimeout</code>: The number of milliseconds before starting the first retry. Default is <code>1000</code>.</li>
<li><code>maxTimeout</code>: The maximum number of milliseconds between two retries. Default is <code>Infinity</code>.</li>
<li><code>randomize</code>: Randomizes the timeouts by multiplying with a factor between <code>1</code> to <code>2</code>. Default is <code>false</code>.</li>
</ul>
<p>The <code>fn</code> function will receive a <code>retry</code> function as its first argument that should be called with an error whenever you want to retry <code>fn</code>. The <code>retry</code> function will always throw an error.<br />
If there are retries left, it will throw a special <code>retry</code> error that will be handled internally to call <code>fn</code> again.
If there are no retries left, it will throw the actual error passed to it.</p>
<p>If you prefer, you can pass the options first using the alternative function signature <code>promiseRetry([options], fn)</code>.</p>
<h2>Example</h2>
<pre><code class="language-js">var promiseRetry = require('promise-retry');

// Simple example
promiseRetry(function (retry, number) {
    console.log('attempt number', number);

    return doSomething()
    .catch(retry);
})
.then(function (value) {
    // ..
}, function (err) {
    // ..
});

// Conditional example
promiseRetry(function (retry, number) {
    console.log('attempt number', number);

    return doSomething()
    .catch(function (err) {
        if (err.code === 'ETIMEDOUT') {
            retry(err);
        }

        throw err;
    });
})
.then(function (value) {
    // ..
}, function (err) {
    // ..
});
</code></pre>
<h2>Tests</h2>
<p><code>$ npm test</code></p>
<h2>License</h2>
<p>Released under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a>.</p>
</body></html>